# Vogue AI ç™»å½•é‡å®šå‘å®ç°æŒ‡å—

## ğŸ“‹ é¡¹ç›®éœ€æ±‚

å®ç°ç”¨æˆ·åœ¨åŠŸèƒ½é¡µé¢æµè§ˆæ—¶çš„æ— ç¼ç™»å½•ä½“éªŒï¼š
- ç”¨æˆ·é€šè¿‡æœç´¢å¼•æ“è¿›å…¥å…·ä½“åŠŸèƒ½é¡µï¼ˆå¦‚ `/ai-baby-generator`ï¼‰
- ç”¨æˆ·å¯ä»¥å…ˆæµè§ˆé¡µé¢å†…å®¹ï¼Œäº†è§£åŠŸèƒ½ç‰¹æ€§
- å½“ç”¨æˆ·å°è¯•ä½¿ç”¨åŠŸèƒ½æ—¶ï¼Œæç¤ºç™»å½•å¹¶**åŸåœ°ç™»å½•**
- ç™»å½•æˆåŠŸå**è‡ªåŠ¨è¿”å›åŸæ¥çš„é¡µé¢**ï¼Œç»§ç»­ä¹‹å‰çš„æ“ä½œ

## ğŸ—ï¸ å½“å‰å®ç°æ¶æ„

### 1. ç™»å½•è§¦å‘æœºåˆ¶

åœ¨å„åŠŸèƒ½é¡µé¢çš„å®¢æˆ·ç«¯ç»„ä»¶ä¸­ï¼Œå½“ç”¨æˆ·ç‚¹å‡»ä½¿ç”¨æŒ‰é’®æ—¶ï¼š

```typescript
// src/components/ai-baby-generator/AIBabyGeneratorClient.tsx
const handleGeneratePress = async () => {
  const supabase = createClient();
  const { data: { user }, error } = await supabase.auth.getUser();

  if (error || !user) {
    // ç”¨æˆ·æœªç™»å½•ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µé¢å¹¶ä¼ é€’å½“å‰é¡µé¢
    router.push('/login');
    return;
  }
  // ç”¨æˆ·å·²ç™»å½•ï¼Œç»§ç»­æ‰§è¡ŒåŠŸèƒ½
}
```

### 2. Header ç»„ä»¶æ™ºèƒ½é‡å®šå‘

Header ç»„ä»¶æ ¹æ®å½“å‰é¡µé¢ç”Ÿæˆå¸¦æœ‰ `next` å‚æ•°çš„ç™»å½•é“¾æ¥ï¼š

```typescript
// src/components/common/Header.tsx
const getLoginUrl = () => {
  if (pathname.startsWith('/ai-baby-generator')) {
    return `/login?next=${encodeURIComponent('/ai-baby-generator')}`;
  }
  if (pathname.startsWith('/ai-baby-podcast')) {
    return `/login?next=${encodeURIComponent('/ai-baby-podcast')}`;
  }
  if (pathname.startsWith('/veo-3-generator')) {
    return `/login?next=${encodeURIComponent('/veo-3-generator')}`;
  }
  return '/login';
};
```

### 3. ç™»å½•é¡µé¢å¤„ç†

ç™»å½•é¡µé¢è·å– `next` å‚æ•°å¹¶åœ¨ç™»å½•æµç¨‹ä¸­ä¼ é€’ï¼š

```typescript
// src/app/login/page.tsx
const handleGoogleSignIn = async () => {
  const next = searchParams.get('next') || '/';
  const redirectTo = `${window.location.origin}/auth/callback?next=${encodeURIComponent(next)}`;

  const { error } = await supabase.auth.signInWithOAuth({
    provider: 'google',
    options: { redirectTo }
  });
};

// é‚®ç®±å¯†ç ç™»å½•
const handleLogin = (formData: FormData) => {
  const next = searchParams.get('next') || '/';
  formData.append('next', next);
  // è°ƒç”¨ server action
  const result = await login(formData);
};
```

### 4. Server Action å¤„ç†

```typescript
// src/app/login/actions.ts
export async function login(formData: FormData) {
  const email = formData.get('email') as string
  const password = formData.get('password') as string
  const next = formData.get('next') as string || '/'

  const { error } = await supabase.auth.signInWithPassword({
    email, password
  })

  if (error) {
    return { success: false, message: `Sign-in failed: ${error.message}` }
  }

  revalidatePath('/', 'layout')
  redirect(next) // é‡å®šå‘åˆ°åŸé¡µé¢
}
```

### 5. OAuth å›è°ƒå¤„ç†

```typescript
// src/app/auth/callback/route.ts
export async function GET(request: NextRequest) {
  const requestUrl = new URL(request.url)
  const code = requestUrl.searchParams.get('code')
  let next = requestUrl.searchParams.get('next') ?? '/'

  // å®‰å…¨éªŒè¯ï¼šåªå…è®¸æŒ‡å®šçš„å†…éƒ¨è·¯å¾„
  const validPaths = ['/ai-baby-generator', '/ai-baby-podcast', '/veo-3-generator', '/'];
  if (!validPaths.includes(next)) {
    next = '/';
  }

  if (code) {
    const supabase = await createClient()
    const { error } = await supabase.auth.exchangeCodeForSession(code)

    if (!error) {
      const redirectUrl = new URL(next, requestUrl.origin);
      return NextResponse.redirect(redirectUrl.toString())
    }
  }

  // å¤±è´¥æ—¶é‡å®šå‘åˆ°ç™»å½•é¡µ
  const errorRedirectUrl = new URL('/login', requestUrl.origin)
  errorRedirectUrl.searchParams.set('message', 'Authentication failed. Please try again.')
  return NextResponse.redirect(errorRedirectUrl.toString())
}
```

## ğŸ”§ å®ç°æ–¹æ¡ˆå¯¹æ¯”

### æ–¹æ¡ˆä¸€ï¼šç›´æ¥ URL é‡å®šå‘ï¼ˆå½“å‰ä½¿ç”¨ï¼‰

**ä¼˜ç‚¹ï¼š**
- å®ç°ç®€å•ï¼Œä»£ç æ¸…æ™°
- åªéœ€é…ç½®ä¸€ä¸ªå›ºå®šçš„å›è°ƒåœ°å€
- æ”¯æŒå¤šåŸŸåå’Œæµ‹è¯•ç¯å¢ƒ
- å®‰å…¨æ€§é«˜ï¼ˆæœ‰ç™½åå•éªŒè¯ï¼‰

**ç¼ºç‚¹ï¼š**
- å¤šä¸€æ¬¡é¡µé¢è·³è½¬ï¼ˆå¯¹ SEO å½±å“æå°ï¼‰

**å®ç°ï¼š**
```typescript
const redirectTo = `${window.location.origin}/auth/callback?next=${encodeURIComponent(next)}`;
```

### æ–¹æ¡ˆäºŒï¼šç›´æ¥åŸåœ°é‡å®šå‘

**ä¼˜ç‚¹ï¼š**
- æœ€å°‘çš„é¡µé¢è·³è½¬

**ç¼ºç‚¹ï¼š**
- éœ€è¦åœ¨ Supabase åå°é…ç½®æ¯ä¸ªå¯èƒ½çš„é‡å®šå‘åœ°å€
- åŸŸåå˜æ›´æ—¶éœ€è¦é‡æ–°é…ç½®
- æµ‹è¯•ç¯å¢ƒå¤æ‚

**å®ç°ï¼š**
```typescript
const redirectTo = window.location.href;
```

## ğŸ“± ç”¨æˆ·ä½“éªŒæµç¨‹

### å…¸å‹ç”¨æˆ·è·¯å¾„ï¼š

1. **ç”¨æˆ·ä» Google æœç´¢è¿›å…¥** `https://vogueai.net/ai-baby-generator`
2. **æµè§ˆé¡µé¢å†…å®¹**ï¼šæŸ¥çœ‹åŠŸèƒ½ä»‹ç»ã€ç¤ºä¾‹ã€FAQ ç­‰
3. **ç‚¹å‡»"å¼€å§‹ç”Ÿæˆ"æŒ‰é’®**ï¼šè§¦å‘ç™»å½•æ£€æŸ¥
4. **é‡å®šå‘åˆ°ç™»å½•é¡µ**ï¼šURL å˜ä¸º `/login?next=%2Fai-baby-generator`
5. **é€‰æ‹© Google ç™»å½•**ï¼šé‡å®šå‘åˆ° Supabase OAuth
6. **Google è®¤è¯å®Œæˆ**ï¼šé‡å®šå‘åˆ° `/auth/callback?next=%2Fai-baby-generator`
7. **ä¼šè¯å»ºç«‹æˆåŠŸ**ï¼šé‡å®šå‘å› `/ai-baby-generator`
8. **ç»§ç»­ä½¿ç”¨åŠŸèƒ½**ï¼šç”¨æˆ·å›åˆ°åŸæ¥çš„é¡µé¢ï¼Œå¯ä»¥ç»§ç»­æ“ä½œ

### æ—¶é—´æˆæœ¬ï¼š
- æ€»é‡å®šå‘æ—¶é—´ï¼šçº¦ 2-3 ç§’
- ç”¨æˆ·æ„ŸçŸ¥ï¼šæ— ç¼è¿”å›åŸé¡µé¢
- SEO å½±å“ï¼šæ— ï¼ˆçˆ¬è™«ä¸ä¼šè§¦å‘ç™»å½•æµç¨‹ï¼‰

## ğŸ”’ å®‰å…¨æ€§è€ƒè™‘

### 1. è·¯å¾„ç™½åå•éªŒè¯

```typescript
const validPaths = ['/ai-baby-generator', '/ai-baby-podcast', '/veo-3-generator', '/'];
if (!validPaths.includes(next)) {
  next = '/'; // é»˜è®¤é‡å®šå‘åˆ°é¦–é¡µ
}
```

### 2. URL ç¼–ç å¤„ç†

```typescript
const next = encodeURIComponent('/ai-baby-generator');
```

### 3. æ¥æºéªŒè¯

OAuth å›è°ƒåªæ¥å—æ¥è‡ª Supabase çš„åˆæ³•è¯·æ±‚ã€‚

## âš™ï¸ Supabase åå°é…ç½®

### Authentication â†’ URL Configuration

```
Site URL: https://www.vogueai.net
Additional redirect URLs: https://www.vogueai.net/auth/callback
```

### Google Cloud OAuth é…ç½®

```
Authorized redirect URIs: 
https://[supabase-project-ref].supabase.co/auth/v1/callback
```

> **æ³¨æ„**ï¼šä¸éœ€è¦æ·»åŠ æ¯ä¸ªåŠŸèƒ½é¡µé¢çš„ URLï¼Œå› ä¸ºä½¿ç”¨äº†ä¸­è½¬é¡µé¢ `/auth/callback`

## ğŸš€ æœ€ä½³å®è·µ

### 1. é¡µé¢çº§ç™»å½•æ£€æŸ¥ä¼˜åŒ–

```typescript
// åœ¨åŠŸèƒ½ç»„ä»¶ä¸­å»¶è¿Ÿç™»å½•æ£€æŸ¥ï¼Œè®©ç”¨æˆ·å…ˆæµè§ˆå†…å®¹
useEffect(() => {
  // ä¸åœ¨ç»„ä»¶åŠ è½½æ—¶ç«‹å³æ£€æŸ¥ç™»å½•çŠ¶æ€
  // åªåœ¨ç”¨æˆ·äº¤äº’æ—¶æ£€æŸ¥
}, []);

const handleUseFeature = async () => {
  // ä»…åœ¨æ­¤æ—¶æ£€æŸ¥ç™»å½•çŠ¶æ€
  const { data: { user } } = await supabase.auth.getUser();
  if (!user) {
    router.push(`/login?next=${encodeURIComponent(pathname)}`);
    return;
  }
  // ç»§ç»­åŠŸèƒ½é€»è¾‘
};
```

### 2. æ™ºèƒ½å›é€€æœºåˆ¶

```typescript
// å¦‚æœ next å‚æ•°æ— æ•ˆï¼Œæ™ºèƒ½é€‰æ‹©å›é€€é¡µé¢
const getDefaultRedirect = (currentPath: string) => {
  if (currentPath.includes('baby')) return '/ai-baby-generator';
  if (currentPath.includes('veo')) return '/veo-3-generator';
  if (currentPath.includes('podcast')) return '/ai-baby-podcast';
  return '/';
};
```

### 3. ç”¨æˆ·çŠ¶æ€æŒä¹…åŒ–

```typescript
// ä½¿ç”¨ Supabase çš„è‡ªåŠ¨ä¼šè¯ç®¡ç†
const { data: authListener } = supabase.auth.onAuthStateChange((event, session) => {
  if (event === 'SIGNED_IN') {
    // ç™»å½•æˆåŠŸåçš„å¤„ç†
    console.log('User signed in:', session?.user);
  }
});
```

## ğŸ” è°ƒè¯•ä¸ç›‘æ§

### 1. æ—¥å¿—è¿½è¸ª

```typescript
console.log('[OAuth Debug] Next parameter:', next);
console.log('[Auth Callback] Redirecting to:', redirectUrl.toString());
```

### 2. é”™è¯¯å¤„ç†

```typescript
if (error) {
  console.error('[Auth] Error:', error.message);
  const errorUrl = new URL('/login', request.url);
  errorUrl.searchParams.set('message', 'Authentication failed. Please try again.');
  return NextResponse.redirect(errorUrl);
}
```

### 3. æˆåŠŸæ ‡è®°

```typescript
// åœ¨æˆåŠŸé‡å®šå‘æ—¶æ·»åŠ æ ‡è®°ä¾¿äºè°ƒè¯•
redirectUrl.searchParams.set('auth_success', 'true');
```

## ğŸ“Š SEO å½±å“åˆ†æ

### âœ… SEO å‹å¥½ç‰¹æ€§ï¼š

1. **æ¯ä¸ªåŠŸèƒ½é¡µé¢éƒ½æœ‰ç‹¬ç«‹ URL**ï¼š`/ai-baby-generator`, `/veo-3-generator`, `/ai-baby-podcast`
2. **é¡µé¢å†…å®¹å¯¹çˆ¬è™«å®Œå…¨å¯è§**ï¼šæ— éœ€ç™»å½•å³å¯æŸ¥çœ‹é¡µé¢å†…å®¹
3. **ç™»å½•æµç¨‹ä¸å½±å“ç´¢å¼•**ï¼šæœç´¢å¼•æ“çˆ¬è™«ä¸ä¼šè§¦å‘ç™»å½•æµç¨‹
4. **å¿«é€Ÿé‡å®šå‘**ï¼šæ€»æ—¶é—´ < 3 ç§’ï¼Œå¯¹ç”¨æˆ·ä½“éªŒå½±å“æœ€å°

### ğŸ¯ æ’åä¼˜åŒ–å»ºè®®ï¼š

1. **ä¿æŒé¡µé¢å†…å®¹ä¸°å¯Œ**ï¼šç¡®ä¿æ¯ä¸ªåŠŸèƒ½é¡µé¢éƒ½æœ‰è¯¦ç»†çš„ä»‹ç»å†…å®¹
2. **ä¼˜åŒ–é¡µé¢åŠ è½½é€Ÿåº¦**ï¼šä½¿ç”¨ Next.js çš„ SSG/SSR ç‰¹æ€§
3. **æ·»åŠ ç»“æ„åŒ–æ•°æ®**ï¼šä¸ºæ¯ä¸ªå·¥å…·é¡µé¢æ·»åŠ  Schema.org æ ‡è®°
4. **å†…éƒ¨é“¾æ¥ä¼˜åŒ–**ï¼šç¡®ä¿å„é¡µé¢é—´æœ‰è‰¯å¥½çš„é“¾æ¥ç»“æ„

## ğŸ’¡ å¸¸è§é—®é¢˜è§£ç­”

### Q: ä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨ `window.location.href` ä½œä¸º redirectToï¼Ÿ
A: è™½ç„¶æ›´ç®€å•ï¼Œä½†éœ€è¦åœ¨ Supabase åå°é…ç½®æ¯ä¸ªå¯èƒ½çš„ URLï¼Œåœ¨å¤šç¯å¢ƒéƒ¨ç½²æ—¶ç®¡ç†å¤æ‚ã€‚å½“å‰æ–¹æ¡ˆåªéœ€é…ç½®ä¸€ä¸ªå›ºå®šçš„å›è°ƒåœ°å€ã€‚

### Q: ä¼šè¯ç®¡ç†å¦‚ä½•å¤„ç†ï¼Ÿ
A: Supabase è‡ªåŠ¨ç®¡ç†ç”¨æˆ·ä¼šè¯ï¼Œä½¿ç”¨ HTTP-only cookies å­˜å‚¨ï¼Œé€šè¿‡ middleware è‡ªåŠ¨åˆ·æ–° tokenã€‚

### Q: å¦‚ä½•å¤„ç†ç™»å½•å¤±è´¥ï¼Ÿ
A: ç™»å½•å¤±è´¥æ—¶é‡å®šå‘åˆ°ç™»å½•é¡µé¢å¹¶æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ï¼Œç”¨æˆ·å¯ä»¥é‡æ–°å°è¯•ã€‚

### Q: æ”¯æŒå“ªäº›ç™»å½•æ–¹å¼ï¼Ÿ
A: å½“å‰æ”¯æŒ Google OAuth å’Œé‚®ç®±å¯†ç ç™»å½•ï¼Œä¸¤ç§æ–¹å¼éƒ½æ”¯æŒåŸåœ°é‡å®šå‘ã€‚

### Q: å¦‚ä½•æ‰©å±•åˆ°æ–°çš„åŠŸèƒ½é¡µé¢ï¼Ÿ
A: 1) åœ¨ `getLoginUrl()` ä¸­æ·»åŠ æ–°è·¯å¾„æ˜ å°„ï¼›2) åœ¨ `validPaths` ä¸­æ·»åŠ æ–°è·¯å¾„ï¼›3) åœ¨åŠŸèƒ½ç»„ä»¶ä¸­æ·»åŠ ç™»å½•æ£€æŸ¥é€»è¾‘ã€‚

## ğŸ¯ å®ç°æ€»ç»“

å½“å‰å®ç°å·²ç»è¾¾åˆ°äº†é¢„æœŸç›®æ ‡ï¼š

âœ… **ç”¨æˆ·å¯ä»¥æ— é˜»ç¢æµè§ˆæ‰€æœ‰åŠŸèƒ½é¡µé¢å†…å®¹**  
âœ… **ä»…åœ¨ä½¿ç”¨åŠŸèƒ½æ—¶æ‰è¦æ±‚ç™»å½•**  
âœ… **ç™»å½•åè‡ªåŠ¨è¿”å›åŸé¡µé¢**  
âœ… **æ”¯æŒå¤šç§ç™»å½•æ–¹å¼ï¼ˆGoogle OAuth + é‚®ç®±å¯†ç ï¼‰**  
âœ… **SEO å‹å¥½ï¼Œä¸å½±å“æœç´¢å¼•æ“æ’å**  
âœ… **å®‰å…¨å¯é ï¼Œæœ‰å®Œå–„çš„é”™è¯¯å¤„ç†**  

è¿™ç§å®ç°æ–¹å¼ç¡®ä¿äº†æœ€ä½³çš„ç”¨æˆ·ä½“éªŒï¼š**ç”¨æˆ·æœåˆ°ä»€ä¹ˆé¡µé¢ï¼Œç™»å½•åå°±å›åˆ°ä»€ä¹ˆé¡µé¢**ï¼ŒçœŸæ­£åšåˆ°äº†"åŸåœ°ç™»å½•ï¼Œå›åˆ°åŸé¡µ"çš„æ— ç¼ä½“éªŒã€‚